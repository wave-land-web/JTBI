<form
  id="contact-form"
  class="space-y-(--site-padding-sm) lsa no-repeat"
  method="POST"
  action="/api/forms/subscribe"
>
  <!-- First and Last Name -->
  <fieldset class="grid grid-cols-2 gap-(--site-padding-sm)">
    <legend class="sr-only">Personal Information</legend>
    <label class="sr-only" for="firstName">First Name (required)</label>
    <input
      type="text"
      name="firstName"
      id="firstName"
      placeholder="First Name*"
      class="w-full input input-primary"
      required
      aria-required="true"
    />
    <label class="sr-only" for="lastName">Last Name (required)</label>
    <input
      type="text"
      name="lastName"
      id="lastName"
      placeholder="Last Name*"
      class="w-full input input-primary"
      required
      aria-required="true"
    />
  </fieldset>

  <!-- Business Name -->
  <fieldset>
    <legend class="sr-only">Business Information</legend>
    <label class="sr-only" for="businessName">Business Name (required)</label>
    <input
      type="text"
      name="businessName"
      id="businessName"
      placeholder="Business Name*"
      class="w-full input input-primary"
      required
      aria-required="true"
    />
  </fieldset>

  <!-- Email + Phone -->
  <fieldset class="grid grid-cols-2 gap-(--site-padding-sm)">
    <legend class="sr-only">Contact Information</legend>
    <label class="sr-only" for="email">Email Address (required)</label>
    <input
      type="email"
      name="email"
      id="email"
      placeholder="Email*"
      class="w-full input input-primary"
      required
      aria-required="true"
      aria-describedby="email-help"
    />
    <label class="sr-only" for="phone">Phone Number (required)</label>
    <input
      type="tel"
      name="phone"
      id="phone"
      placeholder="Phone*"
      class="w-full input input-primary"
      required
      aria-required="true"
    />
  </fieldset>

  <!-- Message textarea -->
  <fieldset>
    <legend class="sr-only">Message (optional)</legend>
    <textarea
      name="message"
      id="message"
      placeholder="Message (optional)"
      class="w-full textarea textarea-primary"
      aria-required="false"></textarea>
  </fieldset>

  <!-- Email Subscription Checkbox -->
  <fieldset class="fieldset mb-8">
    <label
      class="label text-primary font-factoria gap-(--site-padding-sm) whitespace-normal uppercase text-left text-sm font-extrabold"
    >
      <input
        type="checkbox"
        name="isSubscribed"
        class="checkbox checkbox-secondary border-primary bg-base-100"
        checked
      />
      Yes! Of course I want to join your email list.
    </label>
  </fieldset>

  <!-- Submit Button -->
  <div class="flex md:justify-end mb-(--site-padding-sm)">
    <button
      type="submit"
      class="bg-base-100 border border-secondary focus:outline-none focus:bg-secondary hover:bg-secondary w-52 flex justify-between px-0 z-10 group cursor-pointer"
    >
      <span
        class="p w-full p-4 font-extrabold group-hover:text-base-100 group-focus:text-base-100 transition-colors duration-200"
        >SEND INFO</span
      >
      <div
        class="w-1/3 h-full p-2 flex items-center bg-secondary fill-secondary-content group-hover:fill-base-100 group-focus:fill-base-100 transition-colors duration-200"
      >
        <svg
          class="-rotate-45 group-hover:rotate-0 group-focus:rotate-0 transition-transform duration-200"
          viewBox="0 0 20 20"
        >
          <path
            fill-rule="evenodd"
            d="M10.293 3.293a1 1 0 011.414 0l6 6a1 1 0 010 1.414l-6 6a1 1 0 01-1.414-1.414L14.586 11H3a1 1 0 110-2h11.586l-4.293-4.293a1 1 0 010-1.414z"
            clip-rule="evenodd"></path>
        </svg>
      </div>
    </button>
  </div>

  <!-- Form Messages -->
  <div id="form-messages" class="hidden">
    <p id="success-message" class="hidden p-4 text-success bg-success/10 rounded-lg"></p>
    <p id="error-message" class="hidden p-4 text-error bg-error/10 rounded-lg"></p>
  </div>
</form>

<script>
  document.addEventListener('DOMContentLoaded', function () {
    const form = document.getElementById('contact-form') as HTMLFormElement
    const submitButton = form.querySelector('button[type="submit"]') as HTMLButtonElement
    const submitText = submitButton.querySelector('span')

    // Message elements
    const formMessages = document.getElementById('form-messages')
    const successMessage = document.getElementById('success-message')
    const errorMessage = document.getElementById('error-message')

    function hideMessages() {
      formMessages?.classList.add('hidden')
      successMessage?.classList.add('hidden')
      errorMessage?.classList.add('hidden')
    }

    function showSuccessMessage(message: string) {
      hideMessages()
      if (successMessage) successMessage.innerHTML = message
      formMessages?.classList.remove('hidden')
      successMessage?.classList.remove('hidden')

      // Scroll to message
      formMessages?.scrollIntoView({ behavior: 'smooth', block: 'nearest' })
    }

    function showErrorMessage(message: string) {
      hideMessages()
      if (errorMessage) errorMessage.textContent = message
      formMessages?.classList.remove('hidden')
      errorMessage?.classList.remove('hidden')

      // Scroll to message
      formMessages?.scrollIntoView({ behavior: 'smooth', block: 'nearest' })
    }

    if (form && submitButton && submitText) {
      form.addEventListener('submit', async (e) => {
        e.preventDefault()
        hideMessages()

        // Disable submit button and update text
        submitButton.disabled = true
        const originalText = submitText.textContent
        submitText.textContent = 'SENDING...'

        try {
          const formData = new FormData(form)
          const response = await fetch('/api/forms/subscribe', {
            method: 'POST',
            body: formData,
          })

          const result = await response.json()

          if (result.success) {
            const subscriptionNote = result.isSubscribed
              ? `You've also been added to our email list.`
              : ''
            showSuccessMessage(`${result.message} <br /> ${subscriptionNote}`)
            form.reset()
          } else {
            showErrorMessage(result.message || 'An error occurred while submitting the form.')
          }
        } catch (error) {
          console.error('Form submission error:', error)
          showErrorMessage('Sorry, there was an error sending your information. Please try again.')
        } finally {
          // Re-enable submit button and restore text
          submitButton.disabled = false
          if (submitText && originalText) {
            submitText.textContent = originalText
          }
        }
      })
    }
  })
</script>
